<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="https://www.thymeleaf.org/thymeleaf-extras-springsecurity6">
<head>
    <meta charset="UTF-8">
    <title>Gerenciar Processos</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

    <style>
        a { text-decoration: none; }
        a:hover { text-decoration: underline; }
    </style>
</head>

<body class="bg-light">

<div class="container mt-5">

    <h2 class="mb-4">Gerenciar Processos</h2>

    <div class="card shadow p-4 mb-4">
        <h3 class="mb-3">Cadastrar Novo Processo</h3>

        <form th:action="@{/aluno/cadastrar-processo}" method="post"
              th:object="${processo}" enctype="multipart/form-data">

            <div class="mb-3">
                <label class="form-label">Assunto</label>
                <select class="form-select" th:field="*{assunto}">
                    <option value="">Selecione um assunto...</option>
                    <option th:each="assunto : ${listaAssuntos}"
                            th:value="${assunto.id}"
                            th:text="${assunto.nome}"></option>
                </select>
                <div class="text-danger" th:if="${#fields.hasErrors('assunto')}" th:errors="*{assunto}"></div>
            </div>

            <div class="mb-3">
                <label class="form-label">Requerimento (Anexo)</label>
                <input type="file" id="arquivoRequerimento" name="arquivoRequerimento" class="form-control">
                <div class="text-danger" th:if="${#fields.hasErrors('requerimento')}" th:errors="*{requerimento}"></div>
            </div>

            <p th:if="${statusCadastroProcesso}" class="text-success fw-bold"
               th:text="${statusCadastroProcesso}"></p>

            <button type="submit" class="btn btn-success">Cadastrar</button>
        </form>
    </div>

    <div class="card shadow p-4 mb-4">
        <h3 class="mb-3">Buscar Processos</h3>

        <form th:action="@{/aluno/gerenciar-processo}" method="get">

            <div class="mb-3">
                <label class="form-label">Filtrar por Assunto:</label>
                <select id="filtroAssunto" name="assuntoId" class="form-select">
                    <option value="">Todos os assuntos</option>
                    <option th:each="assunto : ${listaAssuntos}"
                            th:value="${assunto.id}"
                            th:text="${assunto.nome}"
                            th:selected="${assuntoId} == ${assunto.id}"></option>
                </select>
            </div>

            <div class="mb-3">
                <label class="form-label">Filtrar por Status:</label>
                <select id="filtroStatus" name="status" class="form-select">
                    <option value="">Todos os status</option>
                    <option th:each="stat : ${T(br.edu.ifpb.pautax.domain.enums.StatusProcesso).values()}"
                            th:value="${stat}"
                            th:text="${stat}"
                            th:selected="${status != null and status.name() == stat.name()}"></option>
                </select>
            </div>

            <div class="mb-3">
                <label class="form-label">Ordenar por:</label>
                <select id="ordenacao" name="sort" class="form-select">
                    <option value="dataRecepcaoDesc"
                            th:selected="(${sort} == null or ${sort} == 'dataRecepcaoDesc')">
                        Data de Registro (Mais Recentes Primeiro)
                    </option>
                    <option value="dataRecepcaoAsc"
                            th:selected="${sort} == 'dataRecepcaoAsc'">
                        Data de Registro (Mais Antigos Primeiro)
                    </option>
                </select>
            </div>

            <div class="d-flex gap-2">
                <button type="submit" class="btn btn-primary">Buscar</button>
                <a th:href="@{/aluno/gerenciar-processo}" class="btn btn-secondary">Limpar Filtros</a>
            </div>
        </form>
    </div>


    <div class="card shadow p-4 mb-5">
        <h3 class="mb-3">Listagem de Processos</h3>

        <table class="table table-striped table-hover">
            <thead class="table-dark">
            <tr>
                <th>ID</th>
                <th>NÃºmero</th>
                <th>Assunto</th>
                <th>Status</th>
                <th>Data de Registro</th>
            </tr>
            </thead>

            <tbody>
            <tr th:each="proc : ${listaProcesso}">
                <td th:text="${proc.id}"></td>
                <td th:text="${proc.numero}"></td>
                <td th:text="${proc.assunto.nome}"></td>
                <td th:text="${proc.statusProcesso}"></td>
                <td th:text="${proc.dataRegistro}"></td>
            </tr>

            <tr th:if="${#lists.isEmpty(listaProcesso)}">
                <td colspan="5" class="text-center text-muted">Nenhum processo encontrado.</td>
            </tr>
            </tbody>
        </table>
    </div>

</div>

</body>
</html>